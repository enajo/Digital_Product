// .devcontainer/devcontainer.json
{
  "name": "QuickDoc Devcontainer",

  // path from .devcontainer/ to your compose file:
  "dockerComposeFile": ["../docker-compose.dev.yml"],

  // the service VS Code will attach to:
  "service": "backend",

  // where in the container your code lives:
  "workspaceFolder": "/app",

  // bring up all three services (db, backend, frontend) together:
  "runServices": ["db", "backend", "frontend"],

  // tear them down when you close the Codespace:
  "shutdownAction": "stopCompose",

  // make both ports available in your browser:
  "forwardPorts": [5000, 5173],

  // after the container is built, install Python & JS deps:
  "postCreateCommand": "pip install -r backend/requirements.txt && npm install --prefix frontend",

  // every time you start (or rebuild) the Codespace:
  // 1) apply any new migrations
  // 2) then launch the React dev server
  "postStartCommand": "flask db upgrade && npm run --prefix frontend dev -- --host 0.0.0.0 --port 5173",

  // give you the Docker extension so you can inspect containers
  "extensions": [
    "ms-azuretools.vscode-docker"
  ]
}
